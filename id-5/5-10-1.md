
# カスタム人事システム

このページでは、一連のAPIインターフェースをLDAPではなく、独自の人事システムを利用しているクライアントに紹介し、ユーザーや部門のデータをOMFLOWに同期できるようにします。

> 注意：このAPIはミドルウェアから提供し、OMFLOWから呼び出す必要がある。

## 証明書

安全なデータ伝送を保証するため、ミドルウェアはSSL/TLS証明書を使用することを強く推奨します。

## データの同期

説明：OMFLOWはこのAPIを呼び出し、ユーザー・部門データの同期を行います。サードパーティのユーザー・部門情報を以下のデータ形式に整理してください。

Method：POST

URL：/sync

Basic Authentication：True

Content-Type：application/json

### 返されるデータ

成功した場合、以下は返されるデータの例です。

``` json
{
    "status": "success",
    "user_info_list" : [{
            "username": "<アカウント>",               //(ユニークな値)
            "email": "<Email>",                //(ユニークな値)
            "nick_name": "<ニックネーム>",
            "ad_no": "<社員番号>",
            "company": "<会社名>",
            "phone1": "<電話番号>",
            "phone2": "<携帯電話>",
            "extension_no": "<内線番号>",
            "gender":"<性別 male/female>"
        },...
    ],
    "group_info_list": [{
            "display_name": "<部門名>",
            "group_no": "<部門番号>",           //(ユニークな値)
            "parent_group_no": "<メイン部門番号>",
            "user_list": [
                "<username1>", 
                "<username2>",
                ...
                ]
        },...
    ]
}

```
> 

失敗した場合、以下は返されるデータの例です。
```json
{
    "status": "fail",
    "message": "<エラーメッセージ>"
}
```


> 注意：  
>- username、email及びgroup_noはユニークな値です。
>- OMFLOWは、usernameとgroup_noで同じユーザーと部門を判定し、もし今回のデータは前回の同期データが異なる場合は、追加、修正、削除を行います。

## ログイン

データを同期した後、ユーザーがログインする際、OMFLOWはこのAPIを呼び出します。 
OMFLOWは以下のようにリクエストを送信します。

```json
{"username": "<アカウント>", "password": "<パスワード>"}
```
以下の内容に従ってログイン認証を行い、認証結果を返送してください。

> 注意：  ログイン認証はユーザー各自で実施し、以下のフォーマットで結果を返送してください。

Method：POST

URL：/authenticate

Basic Authentication：True

Content-Type：application/json

### 返されるデータ

成功した場合、以下は返されるデータの例です。

```json
{
    "status": "success"
}
```
失敗した場合、以下は返されるデータの例です。
```json
{
    "status": "fail",
    "message": "<エラーメッセージ>"
}
```

# データ収集

## データ収集

OMFLOWはServerとCollectorに分かれており、CollectorはServerからディスパッチされたフローのデータ収集を実行し、OMFLOWのデータ監視と解析をサポートします。

### コレクター管理

#### 分類

```
位置：［メインメニュー］＞データ収集＞コレクタ管理
```

1. **未分類**：初めて登録されたすべての「コレクター」は、デフォルトでここにソートされます。
2. **分散処理**：「分散処理」がチェックされていコードコンポーネントまでプロセスが実行されると、このカテゴリのコレクターの1つを選択してコードコンポーネントを実行します。詳細については、【アプリケーション管理>コードコンポーネント】を参照してください。

> ※ コレクターは、インストールまたは再起動後のたびの5分以内にサーバにチェックインします。

#### コレクターリスト

```
位置：［メインメニュー］＞データ収集＞コレクタ管理＞［任意の分類］
```

現在のカテゴリのコレクターのリストが表示されます、説明は下記のとおりです。

1. **レベル**：緑のライトは正常な接続で、赤のライトは接続が切断状態の意味です。
2. **件名**：管理者が編集できるコレクターの表示名です。
3. **ホスト名**：該当のコレクターが配置されているホストのホスト名です。
4. **IPアドレス**：このコレクターが配置されているホストのIPです。
5. **OS**：該当のコレクターが配置されているホストのOSの種類です。

> ※ 削除されたコレクターは、まだ実行中で、ホストにチェックインしている場合は、再びリストに表示されます。

#### コレクター情報

```
位置：［メインメニュー］＞データ収集＞コレクタ管理＞［任意の分類］＞［任意のコレクタ］
```

**基本情報**

の情報が表示されます。サーバがコレクタに正しく接続できるように、「IP、ポート」フィールドは、クライアントの環境に合わせて変更できます。

**パラメータ**

ここではコレクターのシステム引数を設定できます。【アプリケーション管理＞アプリケーションパラメータ】の章同じく、コレクタプロセスが**システム引数**機能を使用するときは、ここの設定を参照します。

**プロセス**

ここでは、コレクターに割り当てられたすべてのプロセスに関する収集データを確認でき、個別のプロセスをキャンセルできます。

\##コレクタプロセス

```
位置：［メインメニュー］＞データ収集＞コレクタプロセス
```

ここではすべてのコレクタプロセスが表示されます。コレクターに送信して定期的に起票し、データをサーバーに返せます。下記はインターフェイスの操作説明です。

1. **新規**：【アプリケーション管理＞アプリケーション設計】と同じく、任意のプロセスを作成し、実行をコレクタを割り当てることができます。その中の**インシデントルール**タブは、次のセッションを参照してください。
2. **削除**：チェックを入れたプロセスを削除します。
3. **コピー**：選択したプロセスをコピーし、新しいプロセスとして作成します。
4. **ディスパッチ**：選択したコレクタを指定して、プロセスを実行します。
5. **実行**：プロセス実行変数、スケジュール、およびプロセスを実行するコレクタを設定します。
6. **データ**：プロセスが収集したデータを確認し、折れ線グラフで表示します。

> 注意事項：
>
> 1. コレクタプロセスはスケジューリングを**実行**する前に、コレクターに**ディスパッチ**される必要があります。
> 2. コレクタはプロセスの終了時に「エンドポイントコンポーネント」の出力データをサーバに返します。データのソースは該当の「エンドポイント」コンポーネントの出力変数で、関連する設定は 【アプリケーション管理＞エンドポイントコンポーネント】を参照してください。

#### インシデントルール

コレクターがデータを返す時、ここでフィルタリングルールを設定でき、システムはイベントルールが準拠しているかどうかを確認し、インシデントチケットを生成します。

> ※ イベント関連フィールドは「エンドポイント」コンポーネントの出力変数を使用できます。関連する設定については、【アプリケーション管理＞エンドポイントコンポーネント】を参照してください。

#### コレクターキット

コレクターが外部ネットワークのある環境にある場合、ユーザーが手動でインストールしなくても、プロセスに必要なパッケージを単独でインストールできます。コレクター自体に外部ネットワークがない場合は、次の2つの方法があります。

1. 環境内にプライベートPIPサーバーがある場合は、【PIPサーバー構築】を参照してください。
2. コレクターが実行する必要のあるコレクタープロセスに応じて手動でダウンロードすることもできます。

### コレクターAPI

```
位置：［メインメニュー］＞データ収集＞コレクターAPI
```

コレクター固有のAPIを作成して、外部がプロセスをコレクターに直接呼び出し、プロセスのエンドポイントの出力をデータセンターに送り返すことができるようにします。各呼び出しは1回だけ実行されます。

> 注意事項：
>
> 1. 情報セキュリティ上の考慮事項により、コレクターはデフォルトで自身とデータセンターからのAPI呼び出しのみを受け入れます。 必要に応じて外部から呼び出すには、コレクターサーバーにログインし、Apacheの下のhttpd.confに信頼できるIPを追加する必要があります。
> 2. API responseの内容はディスパッチプロセスの「エンドポイント」の出力変数であり、関連する設定については、【アプリケーション管理＞エンドポイントコンポーネント】を参照してください。

### イベント管理

```
位置：［メインメニュー］＞データ収集＞イベント管理
```

すべてのイベントはここで管理され、下記３つのタブの機能があります。

#### イベントリスト

すべてのイベントが表示され、中の**ソース分類**イベントは下記４つにわけています。

1. **データ収集**：コレクタプロセスの**インシデントルール**がトリガーで生成したイベントで、イベント条件が成立していない時に自動的にクローズします。
2. **SLA**：アプリケーション管理の**SLA**ルールによってトリガーされ、詳細は【アプリケーション管理＞SLA】を参照してください。条件が成立しない時、またはフォームがクローズされたときに自動的にクローズします。
3. **定期点検**：コレクターとサーバー間の接続が中断されるとトリガーされ、接続が回復すると自動的にクローズします。
4. **API**：外部システムからAPIを経由して呼び出す時に生成し、APIを経由してクローズする必要があります。詳細については、下記の【イベント API】を参照してください。

#### イベントルール

```
位置：［メインメニュー］＞データ収集＞イベント管理＞イベントルール
```

イベントが生成すると、システムは**イベントルール**が満たされているかをチェックします。 ほとんどのフィールドはインシデントチケットの基本フィールドで、中の**インシデントのトリガー条件**は以下の2つの条件を同時に満たさないと成立とみなされません。

1. **時間コンプライアンス**：このルールが指定された時間範囲内に指定されたコンプライアンス時間数に達すると、イベントが生成されます。たとえば、1日に3回発生した場合など。空白の場合は、毎回生成されます。
2. **フィールド条件**：指定されたすべてのフィールドの判定結果が正しい場合、条件を満たしていると見なされます。

> 注意事項：
>
> 1. インシデントは **インシデントルール** の上から下へチェックされ、インシデントにエスカレーションされると停止します。
> 2. 同じイベントがインシデントにエスカレーションされた場合、新しいインシデントチケットは生成しません。

#### イベント API

```
位置：［メインメニュー］＞データ収集＞イベント管理＞イベント API
```

外部システムからOMFLOW上でイベント生成のAPIを提供します。情報セキュリティ上の考慮事項により、コレクターはデフォルトで自身とデータセンターからのAPI呼び出しのみを受け入れます。 必要に応じて外部から呼び出すには、コレクターサーバーにログインし、Apacheの下のhttpd.confに信頼できるIPを追加する必要があります。

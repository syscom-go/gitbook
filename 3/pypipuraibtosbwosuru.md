# pypiプライベートサーバーを設定する

OMFLOWプロセスのコードコンポーネントはPythonコードを実行できます。ユーザーは、インターネットやコミュニティで便利なサンプルプログラムやパッケージを見つけて、独自のプロセスを構築できます。このとき、pythonパッケージを別途インストールする必要がありますので、pythonパッケージのインストール方法を説明します。 サーバーに外部ネットワークがある場合、パッケージのインストールはOMFLOWを介して直接行うことができ、ユーザーはプロセスでpythonコンポーネントのパッケージタブを確認するだけで済みます。\（詳細については、\[[コンポーネントの概要](../5/6.md#fur-fmu)]を参照してください）、インストールする必要のあるパッケージの名前を入力すると、システムは、シェルフプロセス中にパッケージがインストールされているかどうかを確認します。インストールされていない場合、ユーザーのパッケージは自動的にインストールされます。 サーバーに外部ネットワークがない場合、ユーザーはこの時点でプライベートサーバーをセットアップする必要があります。以下では、pypiプライベートサーバーを作成する方法について説明します。

## プライベートサーバーを設定する

基本的な要件：python、pip

プライベートサーバーを設定する最も基本的な方法は、Pythonを環境にインストールすることです。Pythonのインストール方法、環境変数の設定などについては、Pythonの公式ウェブサイトにアクセスして参照してください。ここでは説明を割愛します。

#### STEP1、キットをインストールします

プライベートサーバー環境に外部ネットワークがある場合は、コマンドプロンプトを開き、次のコマンドを入力します

```
pip install devpi-server
pip install devpi-client
```

外部ネットワークがない場合は、外部ネットワークのある環境でパッケージを入手してください。Googleでdevpiを直接検索して、パッケージをダウンロードできます。

{% embed url="https://pypi.org/project/devpi-server/#files" %}

{% embed url="https://pypi.org/project/devpi-client/#files" %}

{% hint style="info" %}
事前に.whlファイルをダウンロードしてください。
{% endhint %}

または、pythonコマンドを使用してダウンロードします。コマンドは、次のとおりです。

```
pip download devpi-server -d <ダウンロードパス>
pip download devpi-client -d <ダウンロードパス>
```

次に、ダウンロードしたwhlファイルをプライベートサーバー環境に移動し、コマンドプロンプトを再度開いて、次のコマンドを入力します。

```
pip install <devpi-server.whlパス>
pip install <devpi-client.whlパス>
```

#### STEP2、devpiサーバーを初期化します

devpiパッケージをインストールした後、プライベートサーバーの初期設定を実行する必要があります。コマンドは次のとおりです。

```
devpi-server --serverdir="/devpi" --init
```

{% hint style="info" %}
\--serverdirの後ろにあるパスはサーバーの場所を表し、自分で調整することができます。
{% endhint %}

#### STEP3、rootアカウントを作成します

devpiサーバーのユーザーを作成するためのコマンドは、次のとおりです。

```
devpi-server --serverdir = "/ devpi" --passwd root

＃パスワードリクエストが表示されます
rootのパスワードを入力してください：
＃パスワードを入力してEnterキーを押すと、パスワードが再度確認されます。
rootのパスワードを繰り返します。
```

#### STEP4、プライベートサーバーを起動します

アカウントを作成したら、サーバーを起動できます。次のコマンドを入力します。

```
devpi-server --serverdir = "/ devpi" --restrict-modify = root --port = 3141 --host = <IPの場所>-start
```

{% hint style="info" %}
\--port = 3141がデフォルト値です（変更可能）。&#x20;

\--host =現在のセットアップ環境のIPを入力してください。
{% endhint %}

{% hint style="warning" %}
プライベートサーバーが設定されている環境に外部ネットワークがある場合は、この手順を完了した後、6番目の手順にスキップしてください。
{% endhint %}

#### STEP5、クライアントを設定します(太字にする)

外部ネットワークがない場合、ユーザーはパッケージを個別にダウンロードし、最終的に統合管理のためにプライベートサーバーにアップロードします。このとき、クライアントパッケージが必要です。設定コマンドは次のとおりです。

```
＃クライアントが指すサーバーの場所を設定する
devpiはhttp：// <IPの場所>：<ポート>を使用します
```

{% hint style="info" %}
ipとportはどちらも、手順4で設定した値です。
{% endhint %}

```
＃ログインする
devpi login root --password = <password>

＃rootユーザーの下に独自のフォルダを作成する
devpiインデックス-cローカル
```

{% hint style="info" %}
ローカルは変更することができます。
{% endhint %}

```
＃作成したばかりのローカルフォルダに切り替えます
devpiはroot / localを使用します

＃ダウンロードしたパッケージをpypiプライベートサーバーにアップロードします
devpi upload --from-dir <さまざまなダウンロードパッケージのwhlファイルへのパス>
```

この時点で、pypiサーバーのセットアップは完了です。

#### STEP6、OMFLOWサーバーを設定します

プライベートサーバーをセットアップした後、OMFLOW設定に移動する必要があるため、アプリケーションがシェルフに配置されると、システムはこの設定に従ってインストールパッケージをpypiサーバーにダウンロードします。

OMFLOWにログイン>システム設定>システム設定

![](../.gitbook/assets/pip-server.png)

プライベートサーバーの場所を入力すると、保存が有効になります。

{% hint style="info" %}
pypiサーバーに外部ネットワークがある場合、入力するパスの場所の例：&#x20;

http：// ：3141 / root / pypi / + simple /
{% endhint %}

{% hint style="info" %}
外部ネットワークがない場合、入力するパスの場所の例：

http：// ：3141 / root / local /
{% endhint %}

pypiサーバーを閉じる

```
devpi-server --serverdir = "/ devpi" --restrict-modify = root --port = 3141 --host = <IPの場所>-stop
```

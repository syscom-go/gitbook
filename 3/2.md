# Linux

## Linux版のインストール

### OMFLOWサーバのインストール <a href="#kai-shi-an-zhuang-omflow-server" id="kai-shi-an-zhuang-omflow-server"></a>

OMFLOWサーバをインストールするための環境を準備します。このドキュメントでは、Ubuntu20.04とCentOS 8、Pythonバージョン3.8.xを例として使用します。他のオペレーティングシステムについては、次の準備手順を参照して準備を完了してください。

### STEP1、Python3環境を準備する <a href="#di-yi-bu-zhou-bi-xu-zhun-bei-python3-de-huan-jing" id="di-yi-bu-zhou-bi-xu-zhun-bei-python3-de-huan-jing"></a>

Ubuntu インストール例

```
apt-get install python3
```

CentOS インストール例

```
yum install python3
```

### STEP2、WebサーバApache Serverをインストールする <a href="#di-er-bu-zhou-an-zhuang-wang-ye-si-fu-qi-apache-server" id="di-er-bu-zhou-an-zhuang-wang-ye-si-fu-qi-apache-server"></a>

Ubuntu Apacheインストール例

```
sudo apt update
apt-get install apache2
```

CentOS Apacheインストール例

```
yum install httpd
```

### STEP3、OMFLOW用のPython実行環境を構築する <a href="#di-si-bu-zhou-jian-li-omflow-de-python-zhi-hang-huan-jing" id="di-si-bu-zhou-jian-li-omflow-de-python-zhi-hang-huan-jing"></a>

```
mkdir /opt/omflow
python3 -m venv /opt/omflow/python
```

### STEP4、Pythonパッケージをインストールする <a href="#di-wu-bu-zhou-an-zhuang-omflow-bi-yao-tao-jian" id="di-wu-bu-zhou-an-zhuang-omflow-bi-yao-tao-jian"></a>

```
mkdir /opt/omflow
python3 -m venv /opt/omflow/python
```

### STEP5、OMFLOWに必要なパッケージをインストールする <a href="#di-wu-bu-zhou-an-zhuang-omflow-bi-yao-tao-jian" id="di-wu-bu-zhou-an-zhuang-omflow-bi-yao-tao-jian"></a>

仮想環境に入り、必要なパッケージをインストールします

```
source /opt/omflow/python/bin/activate
pip install django==2.2 ldap3 mod_wsgi
```

### STEP5、omflowディレクトリの解凍 <a href="#di-liu-bu-zhou-jie-ya-suo-omflow-zi-liao-jia" id="di-liu-bu-zhou-jie-ya-suo-omflow-zi-liao-jia"></a>

解凍 /tmp/omflow.tar.gz&#x20;

```
cd /opt/omflow 
tar zxvf /tmp/omflow.tar.gz
```

フォルダの名前をサーバーに変更します

```
mv /opt/omflow/omflow /opt/omflow/server
```

### STEP7、データベースの準備 <a href="#di-qi-bu-zhou-zi-liao-ku-zhun-bei" id="di-qi-bu-zhou-zi-liao-ku-zhun-bei"></a>

通常、データベースはデフォルトでSQLiteです。別のデータベースを選択する場合は、Webサイトを参照してください

[Django database config](https://docs.djangoproject.com/en/2.2/ref/databases/)​

別のデータベースを選択する場合は、事前にデータベースを作成して、対応する権限を付与してください。 次のデータベースは、追加のパッケージをインストールする必要があります（pipインストールを使用）

{% hint style="warning" %}
データベースパッケージをインストールする前に仮想環境を入力してください`source /opt/omflow/python/bin/activate`
{% endhint %}

必要なパッケージ比較表：

| PostgreSQL |   Oracle   |    SQL Server    |
| :--------: | :--------: | :--------------: |
|  psycopg2  | cx\_Oracle |   django-mssql   |
|            |            |   django-pytds   |
|            |            | django-sqlserver |
|            |            |   django-pyodbc  |

**変更 /opt/omflow/server/omflow/settings.py**\
**以下は settings.py 変更例**

**SQLite** `DATABASES = { "default": { "ENGINE": "django.db.backends.sqlite3", "NAME": os.path.join(BASE_DIR, "db.omflow"), "OPTIONS": {"timeout": 300,} } }`

**PostgreSQL** `DATABASES = { "default": { "ENGINE": "django.db.backends.postgresql", "NAME": "<資料庫名稱>", "USER": "<使用者名稱>", "PASSWORD": "<密碼>", "HOST": "<資料庫IP>", "PORT": "<資料庫PORT>", "OPTSIONS":{"connect_timeout":300} } }`

**MySQL** `DATABASES = { "default": { "ENGINE": "django.db.backends.mysql", "NAME": "<資料庫名稱>", "USER": "<使用者名稱>", "PASSWORD": "<密碼>", "HOST": "<資料庫IP>", "PORT": "<資料庫PORT>", "OPTSIONS":{"connect_timeout":300} } }`

**Oracle** `DATABASES = { "default": { "ENGINE": "django.db.backends.oracle", "NAME": "<資料庫名稱>", "USER": "<使用者名稱>", "PASSWORD": "<密碼>", "HOST": "<資料庫IP>", "PORT": "<資料庫PORT>" } }`

**SQL Server** `DATABASES = { "default": { "ENGINE": "sql_server.pyodbc", "NAME": "<資料庫名稱>", "USER": "<使用者名稱>", "PASSWORD": "<密碼>", "HOST": "<資料庫IP>", "PORT": "<資料庫PORT>", "OPTIONS":{"driver":"","MARS_Connection": True,} } }`

### STEP8、omflow\_config.sh の実行。 <a href="#di-ba-bu-zhou-zhi-hang-omflowconfigsh-dang-an" id="di-ba-bu-zhou-zhi-hang-omflowconfigsh-dang-an"></a>

/opt/omflow/server フォルダーに移動します

```
cd /opt/omflow/server 
./omflow_config.sh
```

### STEP9、タイプは server として選択する。 <a href="#di-jiu-bu-zhou-lei-xing-xuan-ze-wei-server" id="di-jiu-bu-zhou-lei-xing-xuan-ze-wei-server"></a>

> omflow type : server

#### Ubuntu 実行例 <a href="#ubuntu-zhi-hang-fan-li" id="ubuntu-zhi-hang-fan-li"></a>

![OMFLOW typeのところにserverと入力します](https://gblobscdn.gitbook.com/assets%2F-M6SrengyyhO1h0\_BsJ\_%2F-MBqfJS6C\_rkH2evrLe7%2F-MBqi3YpfJaTCDc2Y8ms%2F2020-07-10\_111126.png?alt=media\&token=13e875c7-68e7-4cc0-8211-1bddef7ad215)

![実行後、移行が完了したことを示すメッセージが表示されます](https://gblobscdn.gitbook.com/assets%2F-M6SrengyyhO1h0\_BsJ\_%2F-MBrf6hOupo0a\_-nAlg7%2F-MBrhg55vPAyBhep5cSH%2F2020-07-10\_155227.png?alt=media\&token=f58bed82-3c7b-4181-a2ed-1039ad30e961)

**django.conf の有効化**

実行ファイルは、django.conf（Apache構成ファイル）をApacheフォルダーにコピーするのに役立ち、コマンドで表示できます

`vi /etc/apache2/sites-available/django.conf`

![ django.conf 設定檔畫面](https://gblobscdn.gitbook.com/assets%2F-M6SrengyyhO1h0\_BsJ\_%2F-MBrtrB7XBa2Rqfev1Eo%2F-MBruOsEjKxHaU9HoAiE%2F2020-07-10\_160947.png?alt=media\&token=fae981a0-d351-495f-8b87-595b7f9abad7)

django.conf 構成ファイルの有効化

```
sudo a2ensite django.conf
```

apache 構成ファイルの停止

```
sudo a2dissite 000-default.conf
```

Apacheサービスを再起動します

```
service apache2 reload
```

#### Centos7 実行例 <a href="#centos-7-zhi-hang-fan-li" id="centos-7-zhi-hang-fan-li"></a>

![OMFLOW typeのところにserverと入力します](https://gblobscdn.gitbook.com/assets%2F-M6SrengyyhO1h0\_BsJ\_%2F-MCBb7aBNEnBcJLhhnrD%2F-MCBlv\_E0eZHoa48fYNE%2F2020-07-14\_180300.png?alt=media\&token=b53971e9-6e8b-48d8-8188-3c1a447d2b0c)

![実行後、移行が完了したことを示すメッセージが表示されます](https://gblobscdn.gitbook.com/assets%2F-M6SrengyyhO1h0\_BsJ\_%2F-MCBb7aBNEnBcJLhhnrD%2F-MCBm8JbwPhu3xrJmap1%2F2020-07-14\_180220.png?alt=media\&token=8ef4995e-b5e2-4667-a060-ddfbe6a70dd5)

{% hint style="danger" %}
Migrateにエラーメッセージがある場合django.core.exceptions.ImproperlyConfigured：SQLite 3.8.3以降が必要です（3.7.17等の場合）これは、SQLiteのバージョンが古すぎるためです。
{% endhint %}

ソリューションを提供する

```
cd /tmp 
yum install wget
wget http://www6.atomicorp.com/channels/atomic/centos/7/x86_64/RPMS/atomic-sqlite-sqlite-3.8.5-3.el7.art.x86_64.rpm
yum localinstall atomic-sqlite-sqlite-3.8.5-3.el7.art.x86_64.rpm
mv /lib64/libsqlite3.so.0.8.6{,-3.17}
cp /opt/atomic/atomic-sqlite/root/usr/lib64/libsqlite3.so.0.8.6 /lib64
```

### STEP10、omflow\_server サービスの有効化。 <a href="#di-shi-bu-zhou-qi-yong-omflowserver-fu-wu" id="di-shi-bu-zhou-qi-yong-omflowserver-fu-wu"></a>

omflow\_serverサービスを有効化します

```
systemctl start omflow_server
```

### STEP11、OMFLOWを楽しむ <a href="#di-shi-yi-bu-zhou-kai-shi-xiang-yong-omflow" id="di-shi-yi-bu-zhou-kai-shi-xiang-yong-omflow"></a>

## OMFLOW Collectorのインストールを開始します <a href="#kai-shi-an-zhuang-omflow-collector" id="kai-shi-an-zhuang-omflow-collector"></a>

### STEP1、Python3環境を準備する <a href="#di-yi-bu-zhou-bi-xu-zhun-bei-python3-de-huan-jing" id="di-yi-bu-zhou-bi-xu-zhun-bei-python3-de-huan-jing"></a>

Ubuntu インストール例

```
apt-get install python3
```

CentOS インストール例

```
yum install python3
```

### STEP2、OMFLOW用のPython実行環境を確立す <a href="#di-si-bu-zhou-jian-li-omflow-de-python-zhi-hang-huan-jing" id="di-si-bu-zhou-jian-li-omflow-de-python-zhi-hang-huan-jing"></a>

```
mdkir /opt/omflow
python3 -m venv /opt/omflow/python
```

{% hint style="warning" %}
仮想環境を作成できない場合は、パッケージをインストールしてください`apt-get install python3-venv`
{% endhint %}

### STEP3、OMFLOWに必要なパッケージをインストールする <a href="#di-wu-bu-zhou-an-zhuang-omflow-bi-yao-tao-jian" id="di-wu-bu-zhou-an-zhuang-omflow-bi-yao-tao-jian"></a>

仮想環境に入り、必要なパッケージをインストールします

```
source /opt/omflow/python/bin/activate
pip install django==2.2
```

### STEP4、omflowフォルダを解凍する <a href="#di-liu-bu-zhou-jie-ya-suo-omflow-zi-liao-jia" id="di-liu-bu-zhou-jie-ya-suo-omflow-zi-liao-jia"></a>

/tmp/omflow.tar.gzを解凍する

```
cd /opt/omflow 
tar zxvf /tmp/omflow.tar.gz
```

フォルダの名前を collector に変更します

```
mv /opt/omflow/omflow /opt/omflow/collector
```

### STEP5、omflow\_config.shファイルを実行する <a href="#di-ba-bu-zhou-zhi-hang-omflowconfigsh-dang-an" id="di-ba-bu-zhou-zhi-hang-omflowconfigsh-dang-an"></a>

/ opt / omflow / collectorフォルダーに移動します

```
cd /opt/omflow/collector 
./omflow_config.sh
```

### STEP6、OMFLOWタイプはcollectorと入力する <a href="#di-liu-bu-zhou-lei-xing-xuan-ze-wei-collector" id="di-liu-bu-zhou-lei-xing-xuan-ze-wei-collector"></a>

> omflow type : collector

![omflow type 請輸入 collector](https://gblobscdn.gitbook.com/assets%2F-M6SrengyyhO1h0\_BsJ\_%2F-MBs2c3S94SzLwwcyjsS%2F-MBs9Rnm-nhWjBznsxs2%2F2020-07-10\_173511.png?alt=media\&token=c74aded4-1170-4113-b6a2-e5b8e67fd325)

### STEP7、必要な情報を入力します <a href="#di-qi-bu-zhou-shu-ru-bi-tian-zi-xun" id="di-qi-bu-zhou-shu-ru-bi-tian-zi-xun"></a>

この手順により、/opt/omflow/collector/omflow/settings.py が変更されます

* **Collector port : 5168**
* **Server IP : omflow server IP**
* **Server port : omflow server port**

![collector port、omflow server IP、omflow server port を入力してください](https://gblobscdn.gitbook.com/assets%2F-M6SrengyyhO1h0\_BsJ\_%2F-MBs2c3S94SzLwwcyjsS%2F-MBs9YpQMElUyolXmsuv%2F2020-07-10\_173535.png?alt=media\&token=3cd54d07-43e5-4886-9932-6267916ed76b)

![migrate 完了後の画面](https://gblobscdn.gitbook.com/assets%2F-M6SrengyyhO1h0\_BsJ\_%2F-MBs2c3S94SzLwwcyjsS%2F-MBsB38VI0YOqKgPDFnb%2F2020-07-10\_173647.png?alt=media\&token=35e14548-8639-4c72-b22b-3ca8e236c858)

### STEP8、omflow\_collecterサービスのステータスを確認 <a href="#di-ba-bu-zhou-qing-jian-cha-omflowcollecter-fu-wu-zhuang-tai" id="di-ba-bu-zhou-qing-jian-cha-omflowcollecter-fu-wu-zhuang-tai"></a>

```
systemctl status omflow_collector
```

![サービスのステータスは実行中です](https://gblobscdn.gitbook.com/assets%2F-M6SrengyyhO1h0\_BsJ\_%2F-MBs2c3S94SzLwwcyjsS%2F-MBsBjXSMKVdq6KTNOcI%2F2020-07-10\_180830.png?alt=media\&token=ee199422-538c-44c6-bdd3-a11e40da8128)
